<div class="mb-2">
    <button (click)="this.login()">Login</button>
    <button *ngIf="hasCode()" (click)="this.accessToken()">Access token</button><button *ngIf="hasRefreshToken()" (click)="this.refreshToken()">Refresh token</button>
    <button *ngIf="hasRefreshToken() || hasAccessToken()" (click)="this.revokeToken()">Revoke token</button>
    <button *ngIf="hasResponses()" (click)="this.resetResponses()" class="bg-danger-subtle">Remove responses</button>
    <div *ngIf="configuration_response().length" class="border border-2 border-dark my-3 p-3">
        <label class="fs-3 fw-bolder" [class.bg-danger-subtle]="configuration_error()">
            setConfig() {{ configuration_error() ? "ERROR" : "RESPONSE" }}
            <button class="ms-4 mb-2"
                [class.open]="configuration_open()"
                (click)="configuration_open.set(!configuration_open())">></button>
        </label>
        @for (parm of configuration_response(); track $index; let idx = $index){
        <div class="row" [class.d-none]="!configuration_open()">
            <b class="text-wrap text-break col-6 col-sm-3">{{parm[0]}}</b>
            <span class="text-wrap text-break col-6 col-sm-9 ">{{(parm[1]?.length > 250) ?
                (parm[1] | slice:0:250)+"..." : parm[1]}}
            </span>
        </div>
        }
    </div>
    <div *ngIf="discovery_response().length" class="border border-2 border-dark my-3 p-3">
        <label class="fs-3 fw-bolder" [class.bg-danger-subtle]="discovery_error()">
            DISCOVERY {{ discovery_error() ? "ERROR" : "RESPONSE" }}
            <button class="ms-4 mb-2" [class.open]="discovery_open()"
                (click)="discovery_open.set(!discovery_open())">></button>
        </label>
        @for (parm of discovery_response(); track $index; let idx = $index){
        <div class="row" [class.d-none]="!discovery_open()">
            <b class="text-wrap text-break col-6 col-sm-3">{{parm[0]}}</b>
            <span class="text-wrap text-break col-6 col-sm-9 ">{{(parm[1]?.length > 250) ?
                (parm[1] | slice:0:250)+"..." : parm[1]}}
            </span>
        </div>
        }
    </div>
    <div *ngIf="authorization_response().length" class="border border-2 border-dark my-3 p-3">
        <label class="fs-3 fw-bolder" [class.bg-danger-subtle]="authorization_error()">
            AUTHORIZATION {{ authorization_error() ? "ERROR" : "RESPONSE" }}
            <button class="ms-4 mb-2"
                [class.open]="authorization_open()"
                (click)="authorization_open.set(!authorization_open())">></button>
        </label>
        @for (parm of authorization_response(); track $index; let idx = $index){
            <div class="row" [class.d-none]="!authorization_open()">
                <b class="text-wrap text-break col-6 col-sm-3">{{parm[0]}}</b>
                <span class="text-wrap text-break col-6 col-sm-9 ">{{(parm[1]?.length > 250) ?
                    (parm[1] | slice:0:250)+"..." : parm[1]}}
                </span>
            </div>
        }
    </div>
    <div *ngIf="token_response().length" class="border border-2 border-dark my-3 p-3">
        <label class="fs-3 fw-bolder" [class.bg-danger-subtle]="token_error()">
            TOKEN {{ token_error() ? "ERROR" : "RESPONSE" }}
            <button class="ms-4 mb-2"
                [class.open]="token_open()"
                (click)="token_open.set(!token_open())">></button>
        </label>
        @for (parm of token_response(); track $index; let idx = $index){
            <div class="row" [class.d-none]="!token_open()">
                <b class="text-wrap text-break col-6 col-sm-3">{{parm[0]}}</b>
                <span class="text-wrap text-break col-6 col-sm-9 ">{{(parm[1]?.length > 250) ?
                    (parm[1] | slice:0:250)+"..." : parm[1]}}
                </span>
            </div>
        }
    </div>
    <div *ngIf="verification_response().length" class="border border-2 border-dark my-3 p-3" >
        <label class="fs-3 fw-bolder" [class.bg-danger-subtle]="verification_error()">
            VERIFICATION {{ verification_error() ? "ERROR" : "RESPONSE" }}
            <button class="ms-4 mb-2"
                [class.open]="verification_open()"
                (click)="verification_open.set(!verification_open())">></button>
        </label>
        @for (parm of verification_response(); track $index; let idx = $index){
            <div class="row" [class.d-none]="!verification_open()">
                <b class="text-wrap text-break col-6 col-sm-3">{{parm[0]}}</b>
                <span class="text-wrap text-break col-6 col-sm-9 ">{{(parm[1]?.length > 250) ?
                    (parm[1] | slice:0:250)+"..." : parm[1]}}
                </span>
            </div>
        }
    </div>
    <div *ngIf="revocation_response().length" class="border border-2 border-dark my-3 p-3">
        <label class="fs-3 fw-bolder" [class.bg-danger-subtle]="revocation_error()">
            REVOCATION {{ revocation_error() ? "ERROR" : "RESPONSE" }}
            <button class="ms-4 mb-2" [class.open]="revocation_open()"
                (click)="revocation_open.set(!revocation_open())">></button>
        </label>
        @for (parm of revocation_response(); track $index; let idx = $index){
        <div class="row" [class.d-none]="!revocation_open()">
            <b class="text-wrap text-break col-6 col-sm-3">{{parm[0]}}</b>
            <span class="text-wrap text-break col-6 col-sm-9 ">{{(parm[1]?.length > 250) ?
                (parm[1] | slice:0:250)+"..." : parm[1]}}
            </span>
        </div>
        }
    </div>
</div>
<div class="col-sm-5">
    <fieldset class="credentials d-flex border rounded-3 p-3 mb-3">
        <legend class="credentials float-none text-center w-auto px-3">Authorization server <span
                class="credentials">credentials</span></legend>
        <div class="d-flex flex-column m-auto">
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="radio" name="api" value="google-web-app" [(ngModel)]="api"> Google: Web
                application
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="radio" name="api" value="google-desktop" [(ngModel)]="api"> Google: Desktop
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="radio" name="api" value="custom" [(ngModel)]="api"> Custom credentials
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="radio" name="api" value="custom" [(ngModel)]="api"> Custom configuration object
            </label>
        </div>
        <div *ngIf="api() == 'google-web-app'" class="text-break text-wrap bg-body-secondary ms-2 pe-2 py-2">
            <ul>
                <li>Google credentials must be of type 'Web application'</li>
                <li>The 'issuer' (metadata section) is "https://accounts.google.com"</li>
                <li>'authorization' endpoint uses custom parameters</li>
            </ul>
        </div>
    </fieldset>
    <fieldset class="border rounded-3 p-3 d-flex flex-column mb-3">
        <legend class="float-none text-center w-auto px-3">configuration </legend>
        <div class="m-auto">
            <div class="d-flex flex-wrap mb-2">
                <span class="">authorization_grant</span>
                <div class="col ms-5 ms-sm-2">
                    <label class="d-flex flex-row align-items-start mb-2">
                        <input class="me-2" type="radio" name="grant" value="code" [(ngModel)]="authorization_grant"> Code.
                        (Authorization
                        code)
                    </label>
                    <label class="d-flex flex-row align-items-start mb-2">
                        <input class="me-2" type="radio" name="grant" value="implicit" [(ngModel)]="authorization_grant"> Implicit
                    </label>
                    <label class="d-flex flex-row align-items-start mb-2">
                        <input class="me-2" type="radio" name="grant" value="password" disabled
                            [(ngModel)]="authorization_grant">Password.
                        (Resource Owner Password Credentials)
                    </label>
                    <label class="d-flex flex-row align-items-start mb-2">
                        <input class="me-2" type="radio" name="grant" value="client" disabled [(ngModel)]="authorization_grant"> Client.
                        (Client Credentials)
                    </label>
                    <label class="d-flex flex-row align-items-start mb-2">
                        <input class="me-2" type="radio" name="grant" value="extension" disabled [(ngModel)]="authorization_grant">
                        Extension. (Extension Grants)
                    </label>
                    <label class="d-flex flex-row align-items-start mb-2">
                        <input class="me-2" type="radio" name="grant" value="" disabled [(ngModel)]="authorization_grant"> Unseted.
                    </label>
                </div>
            </div>
            <div class="d-flex flex-wrap mb-2">
                <div class="d-flex flex-row align-items-start mb-2 me-2">
                    <input class="me-2" type="checkbox" value=true [(ngModel)]="no_discovery">
                    no_discovery
                </div>
                <span class="col bg-body-secondary ms-5 ms-sm-2">Ignored if authorization_grant is not "code"</span>
            </div>
            <div class="d-flex flex-wrap mb-2">
                <div class="d-flex flex-row align-items-start mb-2 me-2">
                    <input class="me-2" type="checkbox" value=true [(ngModel)]="no_pkce">
                    no_pkce
                </div>
                <span class="col bg-body-secondary ms-5 ms-sm-2">Ignored if authorization_grant is not "code"</span>
            </div>
            <div class="d-flex flex-wrap mb-2">
                <div class="d-flex flex-row align-items-start mb-2 me-2">
                    <input class="me-2" type="checkbox" value=true [(ngModel)]="no_state">
                    no_state
                </div>
                <span class="col bg-body-secondary ms-5 ms-sm-2">Ignored if authorization_grant is not "code"</span>
            </div>
            <div class="d-flex flex-wrap mb-2">
                <div class="d-flex flex-row align-items-start mb-2 me-2">
                    <input class="me-2" type="checkbox" value=true [(ngModel)]="no_nonce">
                    no_nonce
                </div>
                <span class="col bg-body-secondary ms-5 ms-sm-2">Ignored if authorization_grant is not "code"</span>
            </div>
        </div>
    </fieldset>
    <fieldset *ngIf="true || api() == 'google-web-app' && authorization_grant() == 'code'" class="authorization d-flex border rounded-3 p-3 mb-3">
        <legend class="authorization float-none text-center w-auto px-3">authorization -> <span class="credentials">credentials-dependent</span></legend>
        <div class="mx-auto">
            <label class="d-flex flex-wrap mb-2">
                <span class="text-break col">
                    access_type
                </span>
                <select class="col ms-2" name="access_type" [(ngModel)]="access_type">
                    <option value="" selected>unseted (defaults to online)</option>
                    <option value="online">online</option>
                    <option value="offline">offline</option>
                </select>
            </label>
            <label class="d-flex flex-wrap mb-2">
                <span class="text-break col">
                    include_granted_scopes
                </span>
                <select class="col ms-2" [(ngModel)]="include_granted_scopes">
                    <option value="" selected>unseted (defaults to false)</option>
                    <option [ngValue]=true>true</option>
                    <option [ngValue]=false>false</option>
                </select>
            </label>
            <label class="d-flex flex-wrap mb-2">
                <span class="text-break col">
                    enable_granular_consent
                </span>
                <select class="col ms-2" [(ngModel)]="enable_granular_consent">
                    <option value="" selected>unseted (defaults to true)</option>
                    <option [ngValue]=true>true</option>
                    <option [ngValue]=false>false</option>
                </select>
            </label>
        </div>
        <!-- <div *ngIf="include_granted_scopes()" class="bg-body-secondary ms-2 p-2">
            * If 'include_granted_scopes' and granted scopes includes openid, email or profile
        </div> -->
    </fieldset>
    <fieldset class="metadata border rounded-3 p-3 d-flex flex-column mb-3">
        <legend class="metadata float-none text-center w-auto px-3">metadata -> <span class="credentials">credentials-dependent</span></legend>
        <div class="d-flex mb-2 gap-3">
            <div class="d-flex flex-column flex-grow-0">
                <p>issuer</p>
            </div>
            <div class="d-flex flex-column flex-grow-1" style="min-width: 0;">
                <input type="text" placeholder="issuer" [(ngModel)]="issuer">
            </div>
        </div>
    </fieldset>
    <fieldset class="border rounded-3 p-3 d-flex flex-column mb-3">
        <legend class="float-none text-center w-auto px-3">parameters -> <span class="credentials">credentials-dependent</span></legend>
        <div class="d-flex mb-2 gap-3">
            <div class="d-flex flex-column flex-grow-0">
                <p>client_id</p>
                <p>client_secret</p>
            </div>
            <div class="d-flex flex-column flex-grow-1" style="min-width: 0;">
                <input type="text" placeholder="client_id" [(ngModel)]="client_id">
                <input type="text" placeholder="client_secret" [(ngModel)]="client_secret">
            </div>
        </div>
    </fieldset>
    <fieldset class="border rounded-3 p-3 d-flex flex-column mb-3">
        <legend class="float-none text-center w-auto px-3">parameters -> redirect_uri</legend>
        <div class="d-flex mb-2 gap-3">
            <div class="d-flex flex-column flex-grow-0">
                <p>redirect_uri</p>
            </div>
            <div class="d-flex flex-column flex-grow-1" style="min-width: 0;">
                <input type="text" placeholder="redirect_uri" [(ngModel)]="redirect_uri">
            </div>
        </div>
    </fieldset>
    <fieldset class="d-flex justify-content-center rounded-3 p-3 mb-3">
        <legend class="float-none text-center w-auto px-3">parameters -> response_type</legend>
        <div class="d-flex flex-column col m-auto">
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" [(ngModel)]="code"> code
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" [(ngModel)]="token"> token
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" [(ngModel)]="id_token"> id_token
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" [(ngModel)]="none"> none
            </label>
        </div>
        <label class="col text-center bg-body-secondary flex-grow-0 my-auto mx-2 px-2">Calculated values</label>
        <div class="d-flex flex-column bg-body-secondary col m-auto pt-2 px-2">
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" disabled [ngModel]="calculated_code()"> code
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" disabled [ngModel]="calculated_token()"> token
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" disabled [ngModel]="calculated_id_token()"> id_token
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" disabled [ngModel]="calculated_none()"> none
            </label>
        </div>
    </fieldset>
    <fieldset class="d-flex border rounded-3 p-3 mb-3">
        <legend class="float-none text-center w-auto px-3">parameters -> scope</legend>
        <div class="d-flex flex-column col m-auto">
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" [(ngModel)]="openid">
                    openid
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" [(ngModel)]="email">
                    email
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" [(ngModel)]="profile">
                    profile
            </label>
            <label class="d-flex flex-row text-break align-items-start mb-2">
                <input class="me-2" type="checkbox" [(ngModel)]="api_scope">
                    {{ api_scope_string() }}
            </label>
        </div>
        <label class="col text-center bg-body-secondary flex-grow-0 my-auto mx-2 px-2">Calculated values</label>
        <div class="d-flex flex-column bg-body-secondary col m-auto pt-2 px-2">
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" disabled [ngModel]="calculated_openid()">
                    openid
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" disabled [ngModel]="calculated_email()">
                    email
            </label>
            <label class="d-flex flex-row align-items-start mb-2">
                <input class="me-2" type="checkbox" disabled [ngModel]="calculated_profile()">
                    profile
            </label>
            <label class="d-flex flex-row text-break align-items-start mb-2">
                <input class="me-2" type="checkbox" disabled [ngModel]="calculated_api_scope()">
                    {{ api_scope_string() }}
            </label>
        </div>
        <!-- <div *ngIf="openid() || email() || profile()" class="bg-body-secondary ms-2 p-2">
            * If 'open_id', 'email' or 'profile' is checked, the 'nonce' parameter is generated automatically
        </div> -->
    </fieldset>
</div>
<div class="d-flex flex-column font-monospace col-sm-7" style="min-height: 75vh">
    <label style="z-index: 10" class="text-end me-5 mb-n3 bg-danger text-white ms-auto px-2" [style.visibility]="textModified() ? 'visible' : 'hidden'">Modified by hand</label>
    <label class="bg-danger-subtle mt-3">{{configError()}}</label>
    <textarea style="field-sizing: content; min-height: 30rem;" [ngModel]="config() | json4" (ngModelChange)="'setConfig($event)'" spellcheck="false"></textarea>
</div>

